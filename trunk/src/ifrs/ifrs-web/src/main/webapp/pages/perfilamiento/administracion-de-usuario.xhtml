<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/main-template.xhtml">
	<ui:define name="content">
		<h:form id="form_usuario">
			<p:growl id="messages_usuario" autoUpdate="true" showSummary="true"
				globalOnly="true" />
			<p:ajaxStatus onstart="statusDialog.show();"
				oncomplete="statusDialog.hide();" />
			<ui:include src="/WEB-INF/templates/ajax-dialog-template.xhtml" />
			<p:panel id="filtro_usuario" header="#{msg.label_usuario}"
				toggleable="true" closable="false" toggleSpeed="500"
				closeSpeed="2000" widgetVar="panel">
				<h:panelGrid columns="2">
					<h:outputText value="Nombre de Usuario:" />
					<p:inputText id="it1"
						value="#{usuarioBackingBean.filtroUsuario.nombreUsuario}" />
					<h:outputText value="Nombre:" />
					<p:inputText id="it2" size="40"
						value="#{usuarioBackingBean.filtroUsuario.nombre}" />
					<h:outputText value="Apellido Paterno:" />
					<p:inputText id="it3" size="40"
						value="#{usuarioBackingBean.filtroUsuario.apellidoPaterno}" />
					<h:outputText value="Apellido Materno:" />
					<p:inputText id="it4" size="40"
						value="#{usuarioBackingBean.filtroUsuario.apellidoMaterno}" />
					<h:outputText value="Rol:" />
					<p:selectOneMenu label="Rol" effect="fade" id="so1"
						value="#{usuarioBackingBean.filtroUsuario.rol}"
						converter="rolConverter" required="false">
						<f:selectItem itemLabel="#{msg.label_seleccione}" />
						<f:selectItems
							value="#{usuarioBackingBean.componenteBackingBean.rolItems}" />
					</p:selectOneMenu>
					<p:commandButton value="#{msg.boton_buscar}"
						actionListener="#{usuarioBackingBean.buscarAction}"
						update="tabla_usuario" ajax="false">
					</p:commandButton>
				</h:panelGrid>
				<br />
				<p:toolbar rendered="#{usuarioBackingBean.renderTablaUsuarios}">
					<p:toolbarGroup>
						<p:commandButton icon="ui-icon-disk"
							value="#{msg.guardar_estructura_grupo}" id="btnGuardar"
							actionListener="#{estructuraPorGrupoBackingBean.guardarCatalogoGrupoAction}"
							update="messages_usuario">
						</p:commandButton>
						<p:separator />
						<p:commandButton onclick="dialogNuevoUsuario.show();" icon="ui-icon-document" type="button"
							value="Nuevo Usuario"></p:commandButton>
					</p:toolbarGroup>
				</p:toolbar>
				<p:dataTable emptyMessage="#{msg.mensaje_tabla_sin_registros}"
					value="#{usuarioBackingBean.usuarioList}" id="tabla_usuario"
					var="row" lazy="false" rows="10" paginator="true"
					rendered="#{usuarioBackingBean.renderTablaUsuarios}">
					<p:column headerText="Nombre de Usuario">
						<h:outputText value="#{row.nombreUsuario}" />
					</p:column>
					<p:column headerText="Nombre">
						<h:outputText
							value="#{row.nombre} #{row.apellidoPaterno} #{row.apellidoMaterno}" />
					</p:column>
					<p:column headerText="Fecha Creación">
						<h:outputText value="#{row.fechaCreacion}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>
					<p:column headerText="Rol">
						<h:outputText value="#{row.rol.idRol}" />
					</p:column>
					<p:column headerText="Vigencia">
						<h:outputText value="#{row.vigente eq 1 ? 'SI' : 'NO'}" id="ot10" />
					</p:column>
				</p:dataTable>
			</p:panel>
		</h:form>
		<h:form id="form_newusuario">
			<p:dialog id="pd1" widgetVar="dialogNuevoUsuario"
				header="Agregar Nuevo Usuario" modal="false" closable="true">
				<h:panelGrid columns="3">
					<p:outputLabel value="Nombre de Usuario:" for="it11" />
					<p:inputText id="it11" required="true"
						value="#{usuarioBackingBean.nuevoUsuario.nombreUsuario}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it11" />

					<p:outputLabel value="Nombre:" for="it21" />
					<p:inputText id="it21" size="40" required="true"
						value="#{usuarioBackingBean.nuevoUsuario.nombre}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it21" />

					<p:outputLabel value="Apellido Paterno:" for="it31" />
					<p:inputText id="it31" size="40" required="true"
						value="#{usuarioBackingBean.nuevoUsuario.apellidoPaterno}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it31" />

					<p:outputLabel value="Apellido Materno:" for="it41" />
					<p:inputText size="40" required="true" id="it41"
						value="#{usuarioBackingBean.nuevoUsuario.apellidoMaterno}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it41" />

					<p:outputLabel value="Clave:" for="itcl" />
					<p:inputText size="40" required="true" id="itcl"
						value="#{usuarioBackingBean.nuevoUsuario.password}" />
					<h:message for="itcl" />

					<p:outputLabel value="Email:" for="ite" />
					<p:inputText size="40" required="true" id="ite"
						value="#{usuarioBackingBean.nuevoUsuario.email}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="ite" />

					<p:outputLabel value="Rol:" for="so11" />
					<p:selectOneMenu label="Rol" effect="fade" id="so11"
						value="#{usuarioBackingBean.nuevoUsuario.rol}" required="true"
						converter="rolConverter">
						<f:selectItem itemLabel="#{msg.label_seleccione}" />
						<f:selectItems
							value="#{usuarioBackingBean.componenteBackingBean.rolItems}" />
					</p:selectOneMenu>
					<h:message for="so11" />

					<p:commandButton value="#{msg.boton_guardar}" icon="ui-icon-disk"
						id="btnG" actionListener="#{usuarioBackingBean.guardarAction}"
						oncomplete="handleRequest(xhr, status, args)">
					</p:commandButton>
					<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}" type="button"
						id="btnCancelar" onclick="dialogNuevoUsuario.hide()"></p:commandButton>
				</h:panelGrid>
			</p:dialog>
			<script type="text/javascript">  
		    function handleRequest(xhr, status, args) {  			 		       
		        if(args.validationFailed ) {			      
		            jQuery('#pd1').effect("shake", { times:3 }, 100);  
		        } else { 		        
		        	dialogNuevoUsuario.hide(); 		             
		        }  
		    }  
		</script>
		</h:form>
	</ui:define>
</ui:composition>
