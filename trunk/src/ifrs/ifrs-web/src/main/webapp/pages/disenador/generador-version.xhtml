<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">    
	<h:panelGrid columns="5">
		<h:outputLabel value="#{msg.label_tipo_y_nombre_de_revelacion}" />
		<p:selectOneMenu value="#{generadorVersionBackingBean.tipoCuadro}"
			label="#{msg.label_tipo_revelacion}" required="true" id="gVsom1"
			effect="fade" converter="tipoCuadroConverter" binding="#{generadorVersionBackingBean.comboTipoCatalogo}">
			<f:selectItem itemLabel="#{msg.label_seleccione}" />
			<f:selectItems value="#{generadorVersionBackingBean.componenteBackingBean.tipoCuadroItems}"
				id="gVsi2" />
			<p:ajax listener="#{generadorVersionBackingBean.tipoCuadroChange}"
				partialSubmit="false" update="gVsom2" />
		</p:selectOneMenu>

		<p:selectOneMenu value="#{generadorVersionBackingBean.catalogo}" binding="#{generadorVersionBackingBean.comboCatalogo}"
			label="#{msg.label_nombre_revelacion}" required="true" id="gVsom2"
			effect="fade" converter="catalogoConverter">
			<f:selectItem itemLabel="#{msg.label_seleccione}" />
			<f:selectItems value="#{generadorVersionBackingBean.catalogoList}"
				var="c" itemLabel="#{c.nombre}" itemValue="#{c}" />
		</p:selectOneMenu>



		<p:commandButton id="gVcb1" value="#{msg.boton_buscar}" binding="#{generadorVersionBackingBean.botonBuscarVersiones}"
			icon="ui-icon-search"
			actionListener="#{generadorVersionBackingBean.buscarListener}"
			update="@form">
		</p:commandButton>
		<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}"
			id="btnCancelar1" immediate="true"
			action="principal?faces-redirect=true">
		</p:commandButton>

	</h:panelGrid>

	<p:spacer id="gVsp1" height="20px;" />

	<p:dataTable id="gVdt1" var="var" emptyMessage=" "
		rendered="#{not empty generadorVersionBackingBean.catalogo}"
		value="#{generadorVersionBackingBean.catalogo}" style="width:720px">
		
		<p:column id="gVc3" headerText="Nombre de la Revelación">
			<h:outputText value="#{var.nombre}" />
		</p:column>

		<p:column id="gVc4" headerText="Título de la Revelación">
			<h:outputText value="#{var.titulo}" />
		</p:column>

		<p:column id="gVc5" headerText="Vigente" width="70">
			<h:outputText value="#{var.vigencia eq 1 ? 'SI' : 'NO'}" />
		</p:column>

	</p:dataTable>

	<p:spacer id="gVsp2" height="20px;" />

	<p:dataTable id="gVdt2" var="ver" emptyMessage=" "
		binding="#{generadorVersionBackingBean.versionTable}" rendered="#{generadorVersionBackingBean.renderTablaVersiones}"	
		value="#{generadorVersionBackingBean.versionList}" style="width:720px"
		paginator="true" rows="5" paginatorPosition="top" rowsPerPageTemplate="5,10,15,20">

		<p:column id="gVc1" headerText="Versión">
			<div align="right">
				<h:outputText value="#{ver.version}" />
			</div>
		</p:column>

		<p:column id="gVc2" headerText="Vigente">
			<h:outputText value="#{ver.vigencia eq 1 ? 'SI' : 'NO'}" />
		</p:column>

		<p:column id="gVc3" headerText="Comentario Creación">
		    
			<p:inputTextarea value="#{ver.comentario}" rendered="#{ver.editable}"
				autoResize="true" maxlength="255" style="width:90%;" required="true" 
				requiredMessage="#{msg.mensaje_por_favor_ingrese_un_comentario}" 
				counter="counter"
				counterTemplate="quedan {0} caracteres." />
			<h:outputText id="counter" />
			
			<h:outputText
				value="#{ver.comentario == null ? 'SIN COMENTARIO' : ver.comentario}"
				rendered="#{!ver.editable}" />
		</p:column>

		<p:column id="gVc4" headerText="Fecha Creación">
			<div align="right">
				<h:outputText value="#{ver.fechaCreacion}">
					<f:convertDateTime pattern="#{msg.fecha_hora_pattern}" />
				</h:outputText>
			</div>
		</p:column>

		<p:column headerText="Opciones">
			<p:tooltip for="cl_cv"
				value="Copiar Versión #{ver.version} de la Revelación"></p:tooltip>
			<p:tooltip for="cl_ev"
				value="Editar Versión #{ver.version} de la Revelación"></p:tooltip>
			<div align="center">
				<p:panelGrid columns="3"
					columnClasses="border_none, border_none, border_none"
					style="display: inline;" layout="block">


					<p:commandLink id="cl_ev"
						actionListener="#{generadorVersionBackingBean.buscarEstructuraActionListener}"
						update="@form">
						<p:graphicImage styleClass="ui-icon ui-icon-pencil"
							rendered="#{ver.vigencia eq 1 and ver.idVersion != null}" />
						<f:attribute value="#{ver}" name="version"></f:attribute>
					</p:commandLink>

					<p:spacer width="5" id="s1" />


					<p:commandLink id="cl_cv"
						actionListener="#{generadorVersionBackingBean.prepareCopiarEstructuraActionListener}"
						update="@form">
						<p:graphicImage styleClass="ui-icon ui-icon-copy"
							rendered="#{ver.vigencia eq 1 and ver.idVersion != null}" />
						<f:attribute value="#{ver}" name="version"></f:attribute>
					</p:commandLink>

				</p:panelGrid>
			</div>
		</p:column>

	</p:dataTable>

	<!-- Dialogo de confirmación copiar Estructuras -->
	<p:dialog id="dialog2" header="Confirmación"
		widgetVar="dialogCopiarVersion" dynamic="true" closable="true"
		draggable="false" resizable="false">
		<h:panelGrid columns="3">
			<h:outputText value="#{msg.generador_copiar_version_alert}" />
			<p:spacer />
			<p:spacer />
			<h:outputText value="#{msg.generador_copiar_version_confirm}" />
			<p:spacer />
			<p:spacer />
			<p:spacer width="30" />
			<p:commandButton icon="ui-icon-check"
				value="#{msg.label_copiar_version}"
				id="btnAceptarDialogCopiarVersion"
				actionListener="#{generadorVersionBackingBean.copiarEstructuraActionListener}"
				update="@form">
			</p:commandButton>
			<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}"
				type="button" id="btnCancelarDialogCopiarVersion"
				onclick="dialogCopiarVersion.hide()" update="@form">
			</p:commandButton>
		</h:panelGrid>
	</p:dialog>

	<p:spacer id="gVsp3" height="20px;" />

	<div id="gVdv1" align="right" style="width: 720px;">
		<p:commandButton id="gVcb2" value="#{msg.generador_nueva_version}"
			icon="ui-icon-document"	rendered="#{generadorVersionBackingBean.renderTablaVersiones}"		
			actionListener="#{generadorVersionBackingBean.agregarVersionListener}"
			partialSubmit="true" update="@form" />
	</div>

	<p:spacer height="20px;" />

	<p:dataTable id="gVdt3" emptyMessage=" "
		value="#{generadorVersionBackingBean.estructuraList}" var="row"
		style="width:720px" rowIndexVar="status"
		rendered="#{generadorVersionBackingBean.renderEstructura}">
		
		<f:facet name="header">
			#{msg.label_estructuras_incluidas_en_la_configuración_de_la_revelación}
		</f:facet>
			
		<p:column id="gVc1" headerText="Orden" style="text-align:center">
			<h:outputText value="#{row.orden}" />
		</p:column>

		<p:column id="gVc2" headerText="Tipo de Estructura"
			style="text-align:center;">
			<p:selectOneMenu value="#{row.tipoEstructura}" 
				style="width:130px; text-align:left; border:20px;"
				converter="tipoEstructuraConverter" effect="fade" required="true"
				label="Tipo de Estructura">
				<f:selectItem itemLabel="#{msg.label_seleccione}" />
				<f:selectItems
					value="#{generadorVersionBackingBean.componenteBackingBean.tipoEstructuras}" />
			</p:selectOneMenu>							
		</p:column>

		<p:column id="gVc3" headerText="Agregar o Eliminar"
			style="text-align:center">

			<p:commandButton id="gVcl1" title="Agregar"
				actionListener="#{generadorVersionBackingBean.agregarTipoEstructuraListener}"
				update="@form" icon="ui-icon-circle-plus">
				<f:attribute name="estructura" value="#{row}" />
			</p:commandButton>

			<p:spacer id="gVsp5" width="3px" />

			<p:commandButton id="gVcl2" title="Eliminar"
				icon="ui-icon-circle-minus"
				actionListener="#{generadorVersionBackingBean.eliminarTipoEstructuraListener}"
				update="@form">
				<f:attribute name="estructura" value="#{row}" />
			</p:commandButton>
		</p:column>
		<p:column id="gVc5" headerText="Ordenar" style="text-align:center">
			<p:commandButton id="gVcl51" update="@form"
				actionListener="#{generadorVersionBackingBean.subirEstructuraListener}"
				icon="ui-icon-arrowthick-1-n"
				rendered="#{(generadorVersionBackingBean.sizeEstructrua > 1 ? true : false) and (status == 0 ? false : true)}">
				<f:attribute name="estructura" value="#{row}" />
			</p:commandButton>
			<p:spacer id="gVsp6" width="3px" />
			<p:commandButton id="gVcl61" update="@form"
				icon="ui-icon-arrowthick-1-s"
				actionListener="#{generadorVersionBackingBean.bajarEstructuraListener}"
				rendered="#{(generadorVersionBackingBean.sizeEstructrua > 1 ? true : false) and 
											   (status+1 == generadorVersionBackingBean.sizeEstructrua ? false : true) and 
											   (generadorVersionBackingBean.sizeEstructrua > status+1)}">
				<f:attribute name="estructura" value="#{row}" />
			</p:commandButton>
		</p:column>
	</p:dataTable>

	<p:dialog id="dialog1" header="Información"
		widgetVar="dialogNotDeleteEstr" dynamic="true" closable="true"
		draggable="false" resizable="false">
		<h:panelGrid columns="3">
			<h:outputText
				value="No es posible Eliminar este item debido a que hay configuraciones asociadas." />
			<p:spacer/>
			<p:spacer/>
			
			<p:spacer width="30"/>
			<p:spacer/>
			<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}"
				type="button" id="btnCancelarDialog"
				onclick="dialogNotDeleteEstr.hide()"></p:commandButton>
		</h:panelGrid>
	</p:dialog>
	
	<p:dialog id="idCambiarRevelacion" header="Información"
		widgetVar="dialogCambiarRevelacion" dynamic="true" closable="false"
		draggable="false" resizable="false">
		<h:panelGrid columns="3">
			<h:outputText
				value="Para configurar otra Revelación debe presionar el boton Cancelar y anular todas las acciones de edición." />
			<p:spacer/>
			<p:spacer/>
			
			<p:spacer width="30"/>
			<p:spacer/>
			<p:commandButton icon="ui-icon-wrench" value="#{msg.general_control_aceptar}"
				type="button"
				onclick="dialogCambiarRevelacion.hide()"></p:commandButton>
		</h:panelGrid>
	</p:dialog>

	<p:spacer id="gVsp6" height="10px;" />

	
	<div id="gVsv3" align="right" style="width: 720px;">
		<p:commandButton id="gVcb3" icon="ui-icon-wrench"
			value="#{msg.label_confirmar_configuracion}"
			action="#{generadorVersionBackingBean.guardarEstructura}"
			rendered="#{generadorVersionBackingBean.renderBotonEditar}"
			update="@form" />

		<p:commandButton id="gVcb31" icon="ui-icon-wrench"
			value="#{msg.label_confirmar_configuracion}"
			action="#{generadorVersionBackingBean.editarEstructura}"
			rendered="#{generadorVersionBackingBean.renderBotonEditarVersion}"
			update="@form" />
	</div>


</ui:composition>
