<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/main-template.xhtml">
	<ui:define name="content">
		<h:form id="form_usuario">
			<p:messages id="messages" autoUpdate="true" globalOnly="true"
				showSummary="true" />
			<p:ajaxStatus onstart="statusDialog.show();"
				oncomplete="statusDialog.hide();" />
			<ui:include src="/WEB-INF/templates/ajax-dialog-template.xhtml" />
			<p:panel id="filtro_usuario" header="#{menuBackingBean.breadcrumb}"
				toggleable="true" closable="false" toggleSpeed="500"
				closeSpeed="2000" widgetVar="panel">
				<h:panelGrid columns="3">
					<p:outputLabel value="Nombre de Usuario:" for="it1" />
					<p:inputText id="it1"
						value="#{usuarioBackingBean.filtroUsuario.nombreUsuario}" size="40" required="true" requiredMessage="Ingrese su criterio de búsqueda, ej.: nombre.apellido o primera letra del nombre" />
					<h:message for="it1" styleClass="ui-outputlabel ui-state-error" />
					<!-- h:outputText value="Nombre:" />
					<p:inputText id="it2" size="40"
						value="#{usuarioBackingBean.filtroUsuario.nombre}" />
					<h:outputText value="Apellido Paterno:" />
					<p:inputText id="it3" size="40"
						value="#{usuarioBackingBean.filtroUsuario.apellidoPaterno}" />
					<h:outputText value="Apellido Materno:" />
					<p:inputText id="it4" size="40"
						value="#{usuarioBackingBean.filtroUsuario.apellidoMaterno}" />
					<h:outputText value="Rol:" />
					<p:selectOneMenu label="Rol" effect="fade" id="so1"
						value="#{usuarioBackingBean.rol.idRol}" required="false">
						<f:selectItem itemLabel="#{msg.label_seleccione}" />
						<f:selectItems
							value="#{usuarioBackingBean.componenteBackingBean.rolList}"
							var="rol" itemValue="#{rol.idRol}" itemLabel="#{rol.idRol}" />

					</p:selectOneMenu-->
				</h:panelGrid>
				<h:panelGrid columns="3">
					<p:commandButton value="#{msg.boton_buscar}" icon="ui-icon-search"
						actionListener="#{usuarioBackingBean.buscarAction}"
						update="tabla_usuario" ajax="false">
					</p:commandButton>
					<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}"
						id="btnCancelar11" immediate="true"
						action="administracion-de-usuario?faces-redirect=true">
					</p:commandButton>
					<p:commandButton onclick="dialogNuevoUsuario.show();"
						icon="ui-icon-document" type="button" value="Nuevo Usuario">
					</p:commandButton>
				</h:panelGrid>
			</p:panel>
			<br />
			<p:dataTable emptyMessage="#{msg.mensaje_tabla_sin_registros}"
				value="#{usuarioBackingBean.usuarioList}" id="tabla_usuario"
				var="row" lazy="false" rows="10" paginator="true"
				rendered="#{usuarioBackingBean.renderTablaUsuarios}"
				binding="#{usuarioBackingBean.usuariosTable}">
				<p:column headerText="Nombre de Usuario"
					sortBy="#{row.nombreUsuario}">
					<h:outputText value="#{row.nombreUsuario}" />
				</p:column>
				<p:column headerText="Nombre">
					<h:outputText
						value="#{row.nombre} #{row.apellidoPaterno} #{row.apellidoMaterno}" />
				</p:column>
				<p:column headerText="Fecha Creación">
					<h:outputText value="#{row.fechaCreacion}">
						<f:convertDateTime pattern="dd-MM-yyyy" />
					</h:outputText>
				</p:column>
				<!-- p:column headerText="Rol">
					<h:outputText value="#{row.rol.idRol}" />
				</p:column-->
				<p:column headerText="Vigencia">
					<h:outputText value="#{row.vigente eq 1 ? 'SI' : 'NO'}" id="ot10" />
				</p:column>
				<p:column headerText="Editar">
					<div style="text-align: center;">
						<p:tooltip for="cleu" value="Editar Usuario: #{row.nombreUsuario}"></p:tooltip>
						<p:commandLink id="cleu"
							actionListener="#{usuarioBackingBean.editRowListener}">
							<p:graphicImage styleClass="ui-icon ui-icon-pencil"></p:graphicImage>
						</p:commandLink>
					</div>
				</p:column>
			</p:dataTable>
		</h:form>

		<!-- popup de creacion de usuario -->
		<p:dialog id="pd1" widgetVar="dialogNuevoUsuario" showEffect="drop"
			hideEffect="drop" header="Agregar Nuevo Usuario" modal="false"
			closable="true" dynamic="true">
			<h:form id="form_newusuario">
				<h:panelGrid columns="3">
					<p:column>
						<p:outputLabel value="Nombre de Usuario" for="it11" />
					</p:column>
					<p:column>
						<p:inputText id="it11" required="true"
							style="text-transform: lowercase;"
							binding="#{usuarioBackingBean.inputNombreUsuario}" size="40"
							value="#{usuarioBackingBean.nuevoUsuario.nombreUsuario}"
							validator="#{usuarioBackingBean.validarNuevoUsuario}">
							<f:validateLength minimum="1" maximum="256"></f:validateLength>
						</p:inputText>
					</p:column>
					<p:column>
						<h:message for="it11" styleClass="ui-outputlabel ui-state-error" />
					</p:column>
					<p:outputLabel value="Nombre" for="it21" />
					<p:inputText id="it21" size="40" required="true"
						value="#{usuarioBackingBean.nuevoUsuario.nombre}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it21" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Apellido Paterno" for="it31" />
					<p:inputText id="it31" size="40" required="true"
						value="#{usuarioBackingBean.nuevoUsuario.apellidoPaterno}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it31" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Apellido Materno" for="it41" />
					<p:inputText size="40" required="true" id="it41"
						value="#{usuarioBackingBean.nuevoUsuario.apellidoMaterno}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it41" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Email" for="ite" />
					<p:inputText size="40" required="true" id="ite"
						value="#{usuarioBackingBean.nuevoUsuario.email}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="ite" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Rol" for="so11" />
					<p:selectOneMenu label="Rol" effect="fade" id="so11"
						value="#{usuarioBackingBean.nuevoUsuario.rol.idRol}"
						required="true">
						<f:selectItem itemLabel="#{msg.label_seleccione}" />
						<f:selectItems
							value="#{usuarioBackingBean.componenteBackingBean.rolList}"
							var="rol" itemValue="#{rol.idRol}" itemLabel="#{rol.idRol}" />

					</p:selectOneMenu>
					<h:message for="so11" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Vigente" for="so112" />
					<p:selectOneMenu label="Rol" effect="fade" id="so112"
						value="#{usuarioBackingBean.nuevoUsuario.vigente}" required="true">
						<f:selectItem itemLabel="#{msg.label_seleccione}" />
						<f:selectItems
							value="#{usuarioBackingBean.componenteBackingBean.vigencias}" />

					</p:selectOneMenu>
					<h:message for="so112" styleClass="ui-outputlabel ui-state-error" />

					<p:commandButton value="#{msg.boton_guardar}" icon="ui-icon-disk"
						id="btnG" actionListener="#{usuarioBackingBean.guardarAction}"
						update=":form_usuario:tabla_usuario form_newusuario"
						oncomplete="handleRequest(xhr, status, args)">
					</p:commandButton>
					<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}"
						type="button" id="btnCancelar" onclick="dialogNuevoUsuario.hide()"></p:commandButton>
				</h:panelGrid>
			</h:form>
		</p:dialog>

		<!-- popup de edicion de usuario -->
		<p:dialog id="pd2" widgetVar="dialogEditarUsuario" showEffect="drop"
			hideEffect="drop" header="Editar Usuario" modal="false"
			closable="true" dynamic="true">
			<h:form id="form_editusuario">
				<h:panelGrid columns="3">
					<p:outputLabel value="Nombre de Usuario" for="it11" />
					<p:inputText id="it11" required="true"
						style="text-transform: lowercase;"
						value="#{usuarioBackingBean.editUsuario.nombreUsuario}"
						disabled="true">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it11" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Nombre" for="it211" />
					<p:inputText id="it211" size="40" required="true"
						value="#{usuarioBackingBean.editUsuario.nombre}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it211" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Apellido Paterno" for="it311" />
					<p:inputText id="it311" size="40" required="true"
						value="#{usuarioBackingBean.editUsuario.apellidoPaterno}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it311" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Apellido Materno" for="it411" />
					<p:inputText size="40" required="true" id="it411"
						value="#{usuarioBackingBean.editUsuario.apellidoMaterno}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="it411" styleClass="ui-outputlabel ui-state-error" />

					<h:outputLabel value="Clave" />
					<p:commandLink value="Regenerar clave"
						title="Regenerar clave de Usuario"
						actionListener="#{usuarioBackingBean.resetUsuarioPassword}" update=":form_usuario:tabla_usuario form_editusuario" />
					<p:spacer width="5"/>

					<p:outputLabel value="Email" for="ite1" />
					<p:inputText size="40" required="true" id="ite1"
						value="#{usuarioBackingBean.editUsuario.email}">
						<f:validateLength minimum="1" maximum="256"></f:validateLength>
					</p:inputText>
					<h:message for="ite1" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Rol" for="so111" />
					<p:selectOneMenu label="Rol" effect="fade" id="so111"
						value="#{usuarioBackingBean.editUsuario.rol.idRol}"
						required="true">
						<f:selectItem itemLabel="#{msg.label_seleccione}" />
						<f:selectItems
							value="#{usuarioBackingBean.componenteBackingBean.rolList}"
							var="rol" itemValue="#{rol.idRol}" itemLabel="#{rol.idRol}" />

					</p:selectOneMenu>
					<h:message for="so111" styleClass="ui-outputlabel ui-state-error" />

					<p:outputLabel value="Vigente" for="so1121" />
					<p:selectOneMenu label="Rol" effect="fade" id="so1121"
						value="#{usuarioBackingBean.editUsuario.vigente}" required="true">
						<f:selectItem itemLabel="#{msg.label_seleccione}" />
						<f:selectItems
							value="#{usuarioBackingBean.componenteBackingBean.vigencias}" />

					</p:selectOneMenu>
					<h:message for="so1121" styleClass="ui-outputlabel ui-state-error" />

					<p:commandButton value="#{msg.boton_guardar}" icon="ui-icon-disk"
						id="btnG1" actionListener="#{usuarioBackingBean.editarAction}"
						update=":form_usuario:tabla_usuario form_editusuario"
						oncomplete="handleRequest(xhr, status, args)">
					</p:commandButton>
					<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}"
						type="button" id="btnCancelar1"
						onclick="dialogEditarUsuario.hide()"></p:commandButton>
				</h:panelGrid>
			</h:form>
		</p:dialog>
		<script type="text/javascript">  
		    function handleRequest(xhr, status, args) {  			 		       
		        if(args.validationFailed ) {			      
		            jQuery('#pd1').effect("shake", { times:3 }, 100);  
		        } else { 		        
		        	dialogNuevoUsuario.hide(); 		             
		        }  
		    }  
		</script>

	</ui:define>
</ui:composition>
