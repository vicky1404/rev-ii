<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/main-template.xhtml">
	
	<ui:define name="content">
	
		<h:form id="form">  
		
		<p:messages id="messages" autoUpdate="true" globalOnly="true"/>
		<p:ajaxStatus onstart="statusDialogNoModal.show();" oncomplete="statusDialogNoModal.hide();" />
		<ui:include src="/WEB-INF/templates/ajax-dialog-template.xhtml" />
		
		<p:panel id="filtro" header="#{menuBackingBean.breadcrumb}" toggleable="true"  closable="false" toggleSpeed="500" closeSpeed="2000" widgetVar="panel">  
  		
  		<table border="0" width="50%">
  		<tr>
  			<td>
  				<p:outputLabel value="#{msg.tabla_cabecera_rut}" for="bRut"/>
  			</td>
  			<td>
  				<p:inputText value="#{empresaBackingBean.filtro.idRut}" id="bRut" maxlength="10" size="10">
  					<f:convertNumber integerOnly="true"/>
  				</p:inputText>
  				<p:spacer width="10"></p:spacer>
  				<h:outputText value="#{msg.general_mensaje_rut_sin_puntos_ni_dv}" style="font-weight:bold;"/>  				
  			</td>
  		</tr>
  		<tr>
  			<td>
  				<p:outputLabel value="#{msg.tabla_cabecera_nombre}" for="bNombre"/>
  			</td>
  			<td>
  				<p:inputText value="#{empresaBackingBean.filtro.nombre}" id="bNombre" size="50" maxlength="250"/>  					
  			</td>
  		</tr>  
  		<tr>
  			<td>
  				<p:outputLabel value="#{msg.tabla_cabecera_razon_social}" for="bRazonSocial"/>
  			</td>
  			<td>
  				<p:inputText value="#{empresaBackingBean.filtro.razonSocial}" id="bRazonSocial" size="50" maxlength="250"/>
  			</td>
  		</tr>
  		</table>

  				<p:commandButton value="Buscar" icon="ui-icon-search" actionListener="#{empresaBackingBean.obtenerLista}" update="@form"></p:commandButton>
  				<p:commandButton value="Cancelar" icon="ui-icon-cancel" actionListener="#{empresaBackingBean.limpiar}" update="@form"></p:commandButton>
  		
    	</p:panel> 
		
		
		<p:toolbar style="font-size: 10px; margin-left: auto; margin-right: auto" >
      		<p:toolbarGroup align="left" >
				<p:commandButton icon="ui-icon-document" value="#{msg.boton_nuevo}" title="#{msg.boton_nuevo}"  type="button" onclick="ingresoRegistro.show()" />
				<p:commandButton icon="ui-icon-trash" value="#{msg.boton_eliminar}" title="#{msg.boton_eliminar}" onclick="confirmEliminar.show()"/>
				
      		</p:toolbarGroup>
   		</p:toolbar>
		
		 <p:dataTable value="#{empresaBackingBean.lista}" var="row" binding="#{empresaBackingBean.tabla}" editable="true" rowKey="#{row.idRut}" selectionMode="single" selection="#{empresaBackingBean.selectedTipoCuadro}" emptyMessage="#{msg.mensaje_tabla_sin_registros}" id="tabla" paginator="true" rows="5">
		 	
		 	
		 	<p:ajax event="rowEdit" listener="#{empresaBackingBean.editar}" />  
		 	
		 	<p:column headerText="#{msg.tabla_cabecera_rut}" id="cRut" style="width:10%">
						<h:outputText value="#{row.idRut}" id="oRut">
							<f:convertNumber pattern="#,###,###"/>							
						</h:outputText>
		 	</p:column>
		 	
		 	<p:column headerText="#{msg.tabla_cabecera_dv}" id="cDv" style="width:3%">
						<h:outputText value="#{row.dv}" id="oDv"/>
		 	</p:column>
		 	
		 	
		 	<p:column headerText="#{msg.tabla_cabecera_nombre}" id="cNombre" style="width:25%">
		 		<p:cellEditor id="ceNombre" >
		 			<f:facet name="output">
 						<h:outputText value="#{row.nombre}" id="oNombre" />
 					</f:facet>
 					<f:facet name="input">
 						<p:inputText value="#{row.nombre}" id="iNombre" maxlength="256" size="50"/>
 					</f:facet>
 				</p:cellEditor>
		 	</p:column>	
		 	
		 	<p:column headerText="#{msg.tabla_cabecera_razon_social}" id="cRazonSocial" style="width:25%">
		 		<p:cellEditor id="ceRazonSocial" >
		 			<f:facet name="output">
 						<h:outputText value="#{row.razonSocial}" id="oRazonSocial" />
 					</f:facet>
 					<f:facet name="input">
 						<p:inputText value="#{row.razonSocial}" id="iRazonSocial" maxlength="256" size="50"/>
 					</f:facet>
 				</p:cellEditor>
		 	</p:column>
		 	
		 	<p:column headerText="#{msg.tabla_cabecera_giro}" id="cGiro" style="width:25%">
		 		<p:cellEditor id="ceGiro" >
		 			<f:facet name="output">
 						<h:outputText value="#{row.giro}" id="oGiro" />
 					</f:facet>
 					<f:facet name="input">
 						<p:inputText value="#{row.giro}" id="iGiro" maxlength="256" size="50"/>
 					</f:facet>
 				</p:cellEditor>
		 	</p:column>			
		 	
		 	<p:column headerText="#{msg.tabla_cabecera_editar}" id="cEditar" style="width:5%" >
		 		<p:rowEditor id="rEditor" />
		 	</p:column>
		 	
		 </p:dataTable>
		
		</h:form>
		
		
		<!--  POP UP -->			 
		 <p:dialog header="Ingreso" widgetVar="ingresoRegistro" id="ingreso"  width="600" resizable="false" showEffect="drop" hideEffect="drop" dynamic="true" modal="false" >
		 
		 	<h:form id="formIngreso">
		 	  
	        	<table cellpadding="4" border="0">  
				<tr>
					<td>	
		            <p:outputLabel for="Rut" value="#{msg.tabla_cabecera_rut}" />
		            </td>
		            <td>  
		            <p:inputText value="#{empresaBackingBean.nuevoTipoCuadro.idRut}" id="Rut" label="#{msg.label_nombre}" required="true" size="10">
		            	<f:validateLength minimum="1" maximum="10"></f:validateLength>
		            	<f:convertNumber integerOnly="true" pattern="###" type="number"/>		            	
		            </p:inputText>	
		            </td>
		            <td>  
		            <h:outputText value="#{msg.general_mensaje_rut_sin_puntos_ni_dv}" style="font-weight:bold;"/><p:spacer width="10"></p:spacer>	            
		            <h:message for="Rut" id="msgRut" style="color:red"/>
		            </td>           
				</tr>
				<tr>
					<td>	
		            <p:outputLabel for="Dv" value="#{msg.tabla_cabecera_dv}" />
		            </td>
		            <td>  
		            <p:inputText value="#{empresaBackingBean.nuevoTipoCuadro.dv}" id="Dv" label="#{msg.tabla_cabecera_dv}" required="true" size="3">
		            	<f:validateLength minimum="1" maximum="1"></f:validateLength>
		            </p:inputText>
		            </td>
		            <td>  
		            <h:message for="Dv" id="msgDv" style="color:red"/>           
		            </td>           
				</tr>
				<tr>
					<td>	
		            <p:outputLabel for="Nombre" value="#{msg.tabla_cabecera_nombre}" />
		            </td>
		            <td>  
		            <p:inputText value="#{empresaBackingBean.nuevoTipoCuadro.nombre}" id="Nombre" label="#{msg.label_nombre}" required="true" size="50">
		            	<f:validateLength minimum="1" maximum="256"></f:validateLength>
		            </p:inputText>
		            </td>
		            <td>  
		            <h:message for="Nombre" id="msgNombre" style="color:red"/>           
		            </td>           
				</tr>
				<tr>
					<td>	
		            <p:outputLabel for="RazonSocial" value="#{msg.tabla_cabecera_razon_social}" />
		            </td>
		            <td>  
		            <p:inputText value="#{empresaBackingBean.nuevoTipoCuadro.razonSocial}" id="RazonSocial" label="#{msg.tabla_cabecera_razon_social}" required="true" size="50">
		            	<f:validateLength minimum="1" maximum="256"></f:validateLength>
		            </p:inputText>	
		            </td>
		            <td>  
		            <h:message for="RazonSocial" id="msgRazonSocial" style="color:red"/>
		            </td>           
				</tr>
				<tr>
					<td>	
		            <p:outputLabel for="Giro" value="#{msg.tabla_cabecera_giro}" />
		            </td>
		            <td>  
		            <p:inputText value="#{empresaBackingBean.nuevoTipoCuadro.giro}" id="Giro" label="#{msg.tabla_cabecera_giro}" required="true" size="50">
		            	<f:validateLength minimum="1" maximum="256"></f:validateLength>
		            </p:inputText>
		            </td>
		            <td>  
		            <h:message for="Giro" id="msgGiro" style="color:red"/>	  			
		            </td>           
				</tr>
	        	</table>
				
		  			<p:commandButton icon="ui-icon-disk" value="#{msg.boton_guardar}" actionListener="#{empresaBackingBean.guardar}" id="btnGuardar" update="@form :form:tabla" oncomplete="handleLoginRequest(xhr, status, args)"></p:commandButton>
		  			<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}" id="btnCancelar" onclick="ingresoRegistro.hide()"></p:commandButton>
		  			
        	</h:form>
    	</p:dialog> 
    	
    	
    	<p:dialog header="Confirmar" widgetVar="confirmEliminar" resizable="false">
			<h:form id="formBorrar">
				<h:panelGrid columns="1" style="margin-bottom:10px">
					<h:outputText
						value="Al realizar esta acción, se eliminará la empresa seleccionada" />
					<h:outputText value="¿ Está seguro que desea eliminar esta empresa ?" />
				</h:panelGrid>
				<h:panelGrid columns="3" style="margin-bottom:10px">
					<p:commandButton id="sb1" value="#{msg.boton_eliminar}"
						icon="ui-icon-trash" oncomplete="confirmEliminar.hide();"
						actionListener="#{empresaBackingBean.eliminar}" update=":form:tabla" />
					<p:separator />
					<p:commandButton id="sb2" value="#{msg.boton_cancel}" icon="ui-icon-cancel" oncomplete="confirmEliminar.hide();" />
				</h:panelGrid>
			</h:form>
		</p:dialog>
    	
    	<script type="text/javascript">  
		    function handleLoginRequest(xhr, status, args) {  
			   
		        //if(args.validationFailed || !args.loggedIn) {  //Ejemplo de uso en http://www.primefaces.org/showcase/ui/dialogLogin.jsf
		        if(args.validationFailed ) {
			      
		            jQuery('#ingreso').effect("shake", { times:3 }, 100);  
		        } else { 

		        	
		        	ingresoRegistro.hide(); 
		            //jQuery('#idDeAlgunComponente').fadeOut();  
		        }  
		    }  
		</script> 
		
	</ui:define>
</ui:composition>
