<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/main-template.xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
	<ui:define name="content">
		<h:form id="fGV1" enctype="multipart/form-data">
			<p:messages id="messages_configurador" autoUpdate="true"></p:messages>
			<!-- p:growl id="messages_configurador" autoUpdate="true"
				showSummary="true" globalOnly="true" /-->
			<p:ajaxStatus onstart="statusDialog.show();"
				oncomplete="statusDialog.hide();" />
			<ui:include src="/WEB-INF/templates/ajax-dialog-template.xhtml" />



			<p:tabView effect="fade" id="tv1">

				<p:tab title="Versión de Cuadro" id="tb1"
					titletip="Versión de Cuadro">
					<ui:include src="/pages/disenador/generador-version.xhtml" />
				</p:tab>

				<!-- DISEÑO DE CUADRO -->

				<p:tab title="Diseño de Cuadro" id="tb2">
					<div align="left">
						<h:outputText value="#{msg.generador_titulo_disenador}" id="gDot1"
							disabled="true" />
						<div align="left">
							<p:dataTable
								value="#{generadorVersionBackingBean.estructuraList}" id="gDt90"
								style="width:720px" var="row"
								binding="#{generadorDisenoBackingBean.disenoEstructuraTable}"
								emptyMessage="#{msg.general_sin_informacion}">
								<p:column sortable="false"
									headerText="#{msg.generador_numero_estructura}" align="center"
									id="gDc223" width="150">
									<h:outputText value="#{row.orden}" id="gDot2" />
								</p:column>
								<p:column sortable="false"
									headerText="#{msg.generador_tipo_estructura}" align="center"
									id="gDc222" width="200">
									<h:outputText value="#{row.tipoEstructura.nombre}" id="gDot3" />
								</p:column>
								<p:column sortable="false"
									headerText="#{msg.generador_editar_grilla}" align="center"
									id="gDc233" width="150">
									<p:commandLink title="Editar" value="Editar" id="gDcl1"
										action="#{generadorDisenoBackingBean.editarGrillaAction}"
										rendered="#{generadorVersionBackingBean.almacenado and row.tipoEstructura.idTipoEstructura == 0}"
										partialSubmit="false" update="@form" />

									<p:commandLink title="Editar" value="Editar" id="gDcl2"
										action="#{generadorDisenoBackingBean.editarTextoAction}"
										rendered="#{generadorVersionBackingBean.almacenado and row.tipoEstructura.idTipoEstructura == 2}" />

									<p:commandLink title="Editar" value="Editar" id="gDcl3"
										action="#{generadorDisenoBackingBean.editarHtmlAction}"
										rendered="#{generadorVersionBackingBean.almacenado and row.tipoEstructura.idTipoEstructura == 1}" />

								</p:column>
							</p:dataTable>
							<p:spacer height="20" id="gDs2" />

							<!-- RENDERED  af:group rendered="#{generadorDisenoBackingBean.renderedEditarGrilla}" id="gDg1">-->

							<p:spacer height="20" id="gDs7" />

							<h:outputLabel value="Diseño de Grilla" id="gDol1" />


							<div align="left">

								<!-- RENDERED  af:panelGroupLayout layout="horizontal" id="gDpgl3" rendered="#{generadorVersionBackingBean.renderBotonEditar}">-->
								<div align="left">
									<p:fileUpload label="Archivo" id="gDif1" required="false"
										multiple="false" mode="advanced" update="panel_tabla_disenio"
										cancelLabel="Cancelar"
										invalidFileMessage="El formato del Archivo es invalido, solo se permiten archivos MS Excel en formato 2007 o superior"
										invalidSizeMessage="El Archivo a utilizar no puede superar los 3 MB."
										allowTypes="/(\.|\/)(xlsx|xls)$/"
										fileUploadListener="#{configuradorDisenoBackingBean.cargaArchivoListener}">
									</p:fileUpload>
								</div>
								<p:spacer width="10" id="gDs3" />
								<p:spacer height="25" id="gDs6" />
								<!--af:group rendered="#{generadorDisenoBackingBean.renderdEditarGrillaTable}" id="gDg2" -->
								<table>
									<tr>
										<td><p:inputText label="#{msg.generador_titulo}"
												value="#{generadorDisenoBackingBean.tituloGrilla}"
												id="gDit4" /></td>
										<td><p:commandButton icon="/images/icon/save2.png"
												actionListener="#{generadorDisenoBackingBean.guardarTituloGrillaListener}"
												id="gDcl7" value="Guardar Título" /></td>
									</tr>
								</table>

								<p:spacer width="10" height="10" id="gDs04" />

								<!-- inicio grilla diseño -->
								<h:panelGroup id="panel_tabla_disenio">
									<div class="ui-datatable ui-widget ui-datatable-resizable">
										<table role="grid">
											<thead>
												<tr role="row">
													<th class="ui-state-default ui-resizable-column"
														role="columnheader"></th>
													<ui:repeat var="col"
														value="#{configuradorDisenoBackingBean.grillaVO.columnas}">
														<th class="ui-state-default ui-resizable-column"
															role="columnheader">
															<div class="ui-dt-c" style="width:#{col.ancho+25}px; text-align: center;">
																<span> <h:outputText value="#{col.tituloColumna}" />
																	<br /> <p:commandLink value="Editar Columna"
																		actionListener="#{configuradorDisenoBackingBean.prepareEditarColumnaAction}">
																		<f:attribute name="columna" value="#{col}" />
																	</p:commandLink>
																</span>
															</div>
														</th>
													</ui:repeat>
												</tr>
											</thead>
											<tbody class="ui-datatable-data ui-widget-content">
												<ui:repeat var="col"
													value="#{configuradorDisenoBackingBean.grillaVO.celdaList}"
													varStatus="status">
													<tr class="ui-widget-content ui-datatable-even" role="row"
														data-ri="1">
														<ui:repeat var="row" value="#{col}">
															<ui:fragment rendered="#{row.columna.orden eq 1}">
																<td>
																    <p:tooltip for="clEditFila" value="Editar Fila #{row.idFila}" showEffect="drop"/>
																    <p:commandLink id="clEditFila"
																		actionListener="#{configuradorDisenoBackingBean.prepareEditarFilaAction}"
																		style="padding-left:5px; padding-right:5px; text-decoration:underline;">
																		<f:attribute name="fila" value="#{row.idFila}" />
																		<h:graphicImage value="/resources/images/icon/1rightarrow_16x16.png" style="vertical-align: middle;" />
																	</p:commandLink>
																
																</td>
															</ui:fragment>
															<td role="gridcell">
																<div class="ui-dt-c">
																	<span style="padding-left: 5px"> <h:outputText
																			value="#{row.valor}" id="ot7"
																			style="#{row.tipoCelda.idTipoCelda == 4 or row.tipoCelda.idTipoCelda == 5 ? 'text-align:right;font-weight:bold;color:black' : 'text-align:right;'}"
																			rendered="#{ (row.tipoCelda.idTipoCelda == 0 or row.tipoCelda.idTipoCelda == 4 or row.tipoCelda.idTipoCelda == 5) and (row.tipoDato.idTipoDato != 2 and row.tipoDato.idTipoDato != 3) }"></h:outputText>
																		<h:outputText value="#{row.valor}" id="ot8"
																			inlineStyle="font-weight:bold; text-align:left;"
																			rendered="#{row.tipoCelda.idTipoCelda == 2}"></h:outputText>
																		<p:inputText value="#{row.valor}" id="it7"
																			style="text-align:left;"
																			rendered="#{row.tipoCelda.idTipoCelda == 6 and row.tipoDato.idTipoDato == 0}"
																			maximumLength="#{msg.constantes_max_caracter_cuadro}">
																			<f:validateLength
																				maximum="#{msg.constantes_max_caracter_cuadro}" />
																		</p:inputText> <p:inputText value="#{row.valorLong}" id="it8"
																			rendered="#{( row.tipoDato.idTipoDato == 2 and (row.tipoCelda.idTipoCelda != 4 and row.tipoCelda.idTipoCelda != 5))}"
																			style="text-align:right;"
																			maxlength="#{msg.constantes_text_length_long}">

																			<f:convertNumber integerOnly="true" type="number"
																				maxFractionDigits="0" groupingUsed="true"
																				locale="#{procesoBackingBean.localeCL}"
																				maxIntegerDigits="#{msg.constantes_max_lenght_number}"
																				pattern="##,###,###,###" />
																			<f:validateLongRange
																				maximum="#{msg.constantes_maximum_validate_long_range}" />
																		</p:inputText> <h:outputText value="#{row.valorLong}" id="it28"
																			rendered="#{row.tipoDato.idTipoDato == 2 and (row.tipoCelda.idTipoCelda == 4 or row.tipoCelda.idTipoCelda == 5)}"
																			style="text-align:right;border:none;background-color: white;font-weight:bold;color:black"
																			maxlength="#{msg.constantes_text_length_long}">

																			<f:convertNumber integerOnly="true" type="number"
																				maxFractionDigits="0" groupingUsed="true"
																				locale="#{procesoBackingBean.localeCL}"
																				maxIntegerDigits="#{msg.constantes_max_lenght_number}"
																				pattern="##,###,###,###" />


																		</h:outputText> <p:inputText value="#{row.valorBigDecimal}" id="it9"
																			rendered="#{row.tipoDato.idTipoDato == 3 and (row.tipoCelda.idTipoCelda != 4 and row.tipoCelda.idTipoCelda != 5)}"
																			maximumLength="#{msg.constantes_text_length_decimal}"
																			disabled="#{row.tipoCelda.idTipoCelda == 4 or row.tipoCelda.idTipoCelda == 5}"
																			style="">

																			<f:convertNumber integerOnly="false" type="number"
																				maxIntegerDigits="#{msg.constantes_max_lenght_number}"
																				maxFractionDigits="4"
																				locale="#{procesoBackingBean.localeCL}"
																				pattern="##,###,###,###.####" />
																			<f:validateDoubleRange
																				maximum="#{msg.constantes_maximum_validate_long_range}" />
																		</p:inputText> <p:inputText value="#{row.valorBigDecimal}" id="it09"
																			rendered="#{row.tipoDato.idTipoDato == 3 and (row.tipoCelda.idTipoCelda == 4 or row.tipoCelda.idTipoCelda == 5)}"
																			maximumLength="#{msg.constantes_text_length_decimal}"
																			disabled="#{row.tipoCelda.idTipoCelda == 4 or row.tipoCelda.idTipoCelda == 5}"
																			style="border:none;background-color: white;font-weight:bold;color:black">

																			<f:convertNumber integerOnly="false" type="number"
																				maxIntegerDigits="#{msg.constantes_max_lenght_number}"
																				maxFractionDigits="4"
																				locale="#{procesoBackingBean.localeCL}"
																				pattern="##,###,###,###.####" />

																		</p:inputText> 
																		
																		<p:calendar value="#{row.valorDate}" id="it10"
																			pattern="dd-MM-yyyy" label=" " effect="fade"
																			showOn="button" locale="#{procesoBackingBean.localeCL}" 
																			rendered="#{row.tipoDato.idTipoDato == 1 and row.tipoCelda.idTipoCelda == 6}">																			
																		</p:calendar> 
																		
																		<!-- Editor de tipo de celda y tipo de dato --> 
																		<p:tooltip for="clEditCell" value="Editar Celda [#{row.idFila},#{row.idColumna}]" showEffect="drop"/>
																		<p:commandLink id="clEditCell" style="float:left;"
																			actionListener="#{configuradorDisenoBackingBean.prepareEditarCeldaAction}">
																			<f:attribute value="#{row}" name="celda" />
																			<h:graphicImage style="vertical-align: middle;"
																				value="/resources/images/icon/table-cell_16x16.png" />
																		</p:commandLink>

																	</span>
																</div>
															</td>
														</ui:repeat>
													</tr>
												</ui:repeat>
											</tbody>
										</table>
									</div>
								</h:panelGroup>
								<!-- fin grilla diseño -->

								<!-- Dialogo Editor de Celda -->
								<p:dialog widgetVar="editCellDialog" header="Editar Celda"
									showEffect="drop" style="text-align:left;" hideEffect="drop"
									modal="false" dynamic="false">
									<h:panelGrid columns="2">
										<h:outputLabel value="Tipo de Celda:" />
										<p:selectOneMenu label="Tipo Celda"
											converter="tipoCeldaConverter"
											value="#{configuradorDisenoBackingBean.tipoCeldaCelda}"
											style="width:130px;" id="somec1">
											<f:selectItem itemLabel="#{msg.general_control_seleccione}" />
											<f:selectItems
												value="#{generadorDisenoBackingBean.componenteBackingBean.tipoCeldas}" />
										</p:selectOneMenu>
										<h:outputLabel value="Tipo de Dato:" />
										<p:selectOneMenu label="Tipo Dato" id="somec2"
											value="#{configuradorDisenoBackingBean.tipoDatoCelda}"
											style="width:130px;" converter="tipoDatoConverter">
											<f:selectItem itemLabel="#{msg.general_control_seleccione}" />
											<f:selectItems
												value="#{generadorDisenoBackingBean.componenteBackingBean.tipoDatos}" />
										</p:selectOneMenu>
										<p:commandButton value="Editar Celda"
											actionListener="#{configuradorDisenoBackingBean.editarCeldaAction}"
											icon="ui-icon-disk" update="@form">
										</p:commandButton>
										<p:commandButton icon="ui-icon-cancel"
											value="#{msg.boton_cancel}" type="button" id="btnCancelar2"
											onclick="editCellDialog.hide()" />
									</h:panelGrid>
								</p:dialog>

								<!-- Dialogo Editor de Columna -->
								<p:dialog widgetVar="editColumnDialog" header="Editar Columna"
									showEffect="drop" style="text-align:left;" hideEffect="drop"
									modal="false" dynamic="true" minimizable="false">
									<h:panelGrid columns="3">
										<!-- titulo de columna -->
										<p:outputLabel for="it_tc" value="Título de Columna:" />
										<p:inputText id="it_tc"
											value="#{configuradorDisenoBackingBean.columna.tituloColumna}" />
										<!-- Ancho columna -->
										<p:outputLabel for="col_width_sp" value="Ancho de Columna:" />
										<p:spinner
											value="#{configuradorDisenoBackingBean.columna.ancho}"
											id="col_width_sp" max="999" maxlength="3" size="3" />

										<!-- tipo celda -->
										<h:outputLabel value="Tipo de Celda:" />
										<p:selectOneMenu label="Tipo Celda"
											converter="tipoCeldaConverter"
											value="#{configuradorDisenoBackingBean.tipoCeldaColumna}"
											style="width:130px;">
											<f:selectItem itemLabel="#{msg.general_control_seleccione}" />
											<f:selectItems
												value="#{generadorDisenoBackingBean.componenteBackingBean.tipoCeldas}" />
										</p:selectOneMenu>

										<!-- tipo de dato -->
										<h:outputLabel value="Tipo de Dato:" />
										<p:selectOneMenu label="Tipo Dato"
											value="#{configuradorDisenoBackingBean.tipoDatoColumna}"
											style="width:130px;" converter="tipoDatoConverter">
											<f:selectItem itemLabel="#{msg.general_control_seleccione}" />
											<f:selectItems
												value="#{generadorDisenoBackingBean.componenteBackingBean.tipoDatos}" />
										</p:selectOneMenu>

										<h:outputText value=" " />
										<p:commandButton value="Editar Columna"
											actionListener="#{configuradorDisenoBackingBean.editarColumnaAction}"
											icon="ui-icon-disk" update="@form">
										</p:commandButton>
										<p:commandButton icon="ui-icon-cancel"
											value="#{msg.boton_cancel}" type="button" id="btnCancelar"
											onclick="editColumnDialog.hide()" />
									</h:panelGrid>
								</p:dialog>

								<!-- Dialogo Editor de Fila -->
								<p:dialog widgetVar="editRowDialog" header="Editar Fila"
									showEffect="drop" style="text-align:left;" hideEffect="drop"
									modal="false" dynamic="false">
									<h:panelGrid columns="2">
										<h:outputLabel value="Tipo de Celda:" />
										<p:selectOneMenu label="Tipo Celda"
											converter="tipoCeldaConverter"
											value="#{configuradorDisenoBackingBean.tipoCeldaFila}"
											style="width:130px;" id="somec3">
											<f:selectItem itemLabel="#{msg.general_control_seleccione}" />
											<f:selectItems
												value="#{generadorDisenoBackingBean.componenteBackingBean.tipoCeldas}" />
										</p:selectOneMenu>
										<h:outputLabel value="Tipo de Dato:" />
										<p:selectOneMenu label="Tipo Dato" id="somec4"
											value="#{configuradorDisenoBackingBean.tipoDatoFila}"
											style="width:130px;" converter="tipoDatoConverter">
											<f:selectItem itemLabel="#{msg.general_control_seleccione}" />
											<f:selectItems
												value="#{generadorDisenoBackingBean.componenteBackingBean.tipoDatos}" />
										</p:selectOneMenu>
										<p:commandButton value="Editar Fila"
											actionListener="#{configuradorDisenoBackingBean.editarFilaAction}"
											icon="ui-icon-disk" update="@form">
										</p:commandButton>
										<p:commandButton icon="ui-icon-cancel"
											value="#{msg.boton_cancel}" type="button" id="btnCancelar3"
											onclick="editRowDialog.hide()" />
									</h:panelGrid>
								</p:dialog>

							</div>
						</div>
					</div>
				</p:tab>


				<p:tab title="Agrupación de Columnas" id="tb3">
					<h:panelGrid columns="1" cellpadding="10" id="pg3">
						<h:outputText value="Probando 3" id="ot3" />
					</h:panelGrid>
				</p:tab>

				<p:tab title="Previsualizador" id="tb4">
					<h:panelGrid columns="1" cellpadding="10" id="pg4">
						<h:outputText value="Probando 4" id="ot4" />
					</h:panelGrid>
				</p:tab>


			</p:tabView>

		</h:form>

	</ui:define>
</ui:composition>

