<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/main-template.xhtml">
	<ui:define name="content">
		<h:form id="f_historial">
		    <p:messages autoUpdate="true"></p:messages>
			<p:ajaxStatus onstart="statusDialog.show();"
				oncomplete="statusDialog.hide();" />
			<ui:include src="/WEB-INF/templates/ajax-dialog-template.xhtml" />
			<p:panel id="filtro_reporte_cuadro"
				header="#{msg.titulo_exportar_reportes}" toggleable="true"
				closable="false" toggleSpeed="500" closeSpeed="2000"
				widgetVar="panel">

				<h:panelGrid border="0" columns="3" style="width:335px;">
					<h:column headerClass="ancho250">
						<p:outputLabel value="#{msg.label_periodo}:" style="width:200px;"
							for="soc1" />
					</h:column>
					<h:column>
						<p:selectOneMenu id="soc1" label=" "
							unselectedLabel="#{msg.label_seleccione}"
							value="#{reporteBackingBean.filtroBackingBean.mes}"
							required="true">
							<f:selectItem itemLabel="#{msg.label_seleccione}" />
							<f:selectItems
								value="#{reporteBackingBean.componenteBackingBean.meses}"
								id="si1" />
						</p:selectOneMenu>
						<p:selectOneMenu id="soc2" label=" " style="margin-left:5px;"
							unselectedLabel="#{msg.label_seleccione}"
							value="#{reporteBackingBean.filtroBackingBean.anio}"
							required="true">
							<f:selectItem itemLabel="#{msg.label_seleccione}" />
							<f:selectItems
								value="#{reporteBackingBean.componenteBackingBean.anios}"
								id="si2" />
						</p:selectOneMenu>
						<h:message for="si1" styleClass="ui-outputlabel ui-state-error" />
					</h:column>
					<h:column>

					</h:column>
				</h:panelGrid>
				<h:panelGrid columns="3">
					<h:outputLabel value=" " />
					<p:commandButton value="#{msg.boton_buscar}" icon="ui-icon-search"
						action="#{historialReporteBackingBean.buscarAction}"
						update="@form" ajax="false">
					</p:commandButton>
					<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}"
						id="btnCancelar11" immediate="true"
						action="historial-reporte?faces-redirect=true">
					</p:commandButton>
				</h:panelGrid>
			</p:panel>
			<p:toolbar
				rendered="#{historialReporteBackingBean.renderHistorialReportes}">
				<p:toolbarGroup>

				</p:toolbarGroup>
			</p:toolbar>
			<p:dataTable
				value="#{historialReporteBackingBean.historialReporteList}"
				emptyMessage="#{msg.mensaje_tabla_sin_registros}"
				id="tabla_historial_reporte" var="row" lazy="true"
				rendered="#{historialReporteBackingBean.renderHistorialReportes}"
				selectionMode="single" rowKey="#{row.idHistorialReporte}">
				<p:column headerText="Usuario" sortable="true"
					sortProperty="usuarioOid" align="start" id="c1">
					<h:outputText value="#{row.usuario}" id="ot1" />
				</p:column>
				<p:column sortable="false" headerText="IP Usuario" align="right"
					id="c2">
					<h:outputText value="#{row.ipUsuario}" id="ot2" />
				</p:column>
				<p:column sortable="true" sortProperty="fechaExportacion"
					headerText="Fecha Generación" align="right" id="c3" width="120">
					<h:outputText value="#{row.fechaExportacion}" id="ot3">
						<f:convertDateTime pattern="dd-MM-yyyy HH:mm:ss" />
					</h:outputText>
				</p:column>
				<p:column sortable="false" headerText="Check Sum Comprobación"
					align="start" id="c4" width="220">
					<h:outputText value="#{row.checkSumExportacion}" id="ot4"
						inlineStyle="text-transform:uppercase;" />
				</p:column>
				<p:column sortable="false" headerText="Comentario" align="start"
					id="c5">
					<h:outputText value="#{row.comentario}" id="ot5" />
				</p:column>
				<p:column sortable="false" headerText="Período" align="right"
					id="c8" width="70">
					<h:outputText
						value="#{row.periodo.anioPeriodo}-#{row.periodo.mesPeriodo}"
						id="ot8_1" />
				</p:column>
				<p:column sortable="false" headerText="Validar Archivo" align="center" id="c6" width="60">
                        <p:commandLink icon="/images/icon/validate-file.gif" shortDesc="Validar Archivo: \'#{row.nombreArchivo}\'"
                                             id="cil1">                                                    
                            
                        </p:commandLink>
                        
                            <p:dialog title="Validar Archivo" id="d2" contentWidth="250" type="cancel" modal="false">
                                <af:panelFormLayout id="pfl2">
                                    <div align="left" style="width: 720px;">
									<p:fileUpload label="Seleccionar Archivo" id="gDif1"
										required="true"										
										requiredMessage="Debe seleccionar el Archivo para validar."
										multiple="false" mode="advanced" update="@form"
										cancelLabel="Cancelar"
										invalidFileMessage="El formato del Archivo es invalido, solo se permiten archivos MS Word en formato 2007 o superior"
										invalidSizeMessage="El Archivo a utilizar no puede superar los 3 MB."
										sizeLimit="3145728" allowTypes="/(\.|\/)(docx)$/"
										fileUploadListener="#{historialReporteBackingBean.cargaArchivoListener}">
									</p:fileUpload>
								</div>
                                    <af:spacer width="10" height="20" id="s3"/>
                                    <f:facet name="footer">
                                        <af:panelGroupLayout id="pgl1" halign="right">
                                            <af:commandButton text="Validar Archivo" id="cb1223" blocking="true"
                                                              partialSubmit="false"
                                                              actionListener="#{historialReporteBackingBean.validarArchivo}"
                                                              icon="/images/icon/drive-upload.png">
                                                <f:attribute name="historialReporte" value="#{row}"/>
                                            </af:commandButton>
                                        </af:panelGroupLayout>
                                    </f:facet>
                                </af:panelFormLayout>
                            </p:dialog>
                        
                    </p:column>
			</p:dataTable>
		</h:form>
	</ui:define>
</ui:composition>
