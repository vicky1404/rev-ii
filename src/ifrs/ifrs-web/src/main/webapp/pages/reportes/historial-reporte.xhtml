<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/main-template.xhtml">
	<ui:define name="content">
		<h:form id="f_historial">
			<p:messages autoUpdate="true"></p:messages>
			<p:ajaxStatus onstart="statusDialog.show();"
				oncomplete="statusDialog.hide();" />
			<ui:include src="/WEB-INF/templates/ajax-dialog-template.xhtml" />
			<p:panel id="filtro_reporte_cuadro"
				header="Historial de generación de reportes MS Word"
				toggleable="true" closable="false" toggleSpeed="500"
				closeSpeed="2000" widgetVar="panel">

				<h:panelGrid border="0" columns="3" style="width:335px;">
					<h:column headerClass="ancho250">
						<h:outputLabel value="#{msg.label_periodo}:" style="width:200px;"
							for="soc1" />
					</h:column>
					<h:column>
						<p:selectOneMenu id="soc1" label="Año período"
							unselectedLabel="#{msg.label_seleccione}"
							value="#{reporteBackingBean.filtroBackingBean.mes}"
							required="true" effect="fade">
							<f:selectItem itemLabel="#{msg.label_seleccione}" />
							<f:selectItems
								value="#{reporteBackingBean.componenteBackingBean.meses}"
								id="si1" />
						</p:selectOneMenu>
						<p:selectOneMenu id="soc2" label="Mes período" style="margin-left:5px;"
							unselectedLabel="#{msg.label_seleccione}"
							value="#{reporteBackingBean.filtroBackingBean.anio}"
							required="true" effect="fade">
							<f:selectItem itemLabel="#{msg.label_seleccione}" />
							<f:selectItems
								value="#{reporteBackingBean.componenteBackingBean.anios}"
								id="si2" />
						</p:selectOneMenu>
						<h:message for="si1" styleClass="ui-outputlabel ui-state-error" />
					</h:column>
					<h:column>

					</h:column>
				</h:panelGrid>
				<h:panelGrid columns="3">
					<h:outputLabel value=" " />
					<p:commandButton value="#{msg.boton_buscar}" icon="ui-icon-search"
						action="#{historialReporteBackingBean.buscarAction}"
						update="@form" ajax="false">
					</p:commandButton>
					<p:commandButton icon="ui-icon-cancel" value="#{msg.boton_cancel}"
						id="btnCancelar11" immediate="true"
						action="historial-reporte?faces-redirect=true">
					</p:commandButton>
				</h:panelGrid>
			</p:panel>
			<p:spacer height="5"></p:spacer>
			<p:dataTable
				value="#{historialReporteBackingBean.historialReporteList}"
				emptyMessage="#{msg.mensaje_tabla_sin_registros}"
				id="tabla_historial_reporte" var="row" lazy="true"
				rendered="#{historialReporteBackingBean.renderHistorialReportes}"
				selectionMode="single" rowKey="#{row.idHistorialReporte}"
				paginatorPosition="top" paginator="true" rows="30"
				rowsPerPageTemplate="10,20,30"
				binding="#{historialReporteBackingBean.historialReporteTable}">
				<p:column headerText="Usuario" id="c1">
					<h:outputText value="#{row.usuario.nombreUsuario}" id="ot1" />
				</p:column>
				<p:column sortable="false" headerText="IP Usuario" align="right"
					id="c2">
					<h:outputText value="#{row.ipUsuario}" id="ot2" />
				</p:column>
				<p:column headerText="Fecha Generación" id="c3">
					<h:outputText value="#{row.fechaExportacion}" id="ot3">
						<f:convertDateTime pattern="dd-MM-yyyy HH:mm:ss" />
					</h:outputText>
				</p:column>
				<p:column headerText="Check Sum Comprobación" id="c4">
					<h:outputText value="#{row.checkSumExportacion}" id="ot4"
						style="text-transform:uppercase;" />
				</p:column>
				<p:column headerText="Comentario" id="c5">
					<h:outputText value="#{row.comentario}" id="ot5" />
				</p:column>
				<p:column headerText="Descargar">
					<div align="center">
						<p:commandLink id="downloadLink" ajax="false"
							title="Descargar Archivo: #{row.nombreArchivo}"
							actionListener="#{historialReporteBackingBean.fileDownloadListener}"
							onclick="PrimeFaces.monitorDownload(start, stop)">
							<p:graphicImage styleClass="ui-icon ui-icon-arrowstop-1-s"></p:graphicImage>
							<p:fileDownload
								value="#{historialReporteBackingBean.downloadedFile}" />
						</p:commandLink>
					</div>
				</p:column>
				<p:column headerText="Validar Archivo" id="c6">
					<div align="center">
						<p:commandLink title="Validar Archivo: #{row.nombreArchivo}"
							id="cil1" update="@form"
							actionListener="#{historialReporteBackingBean.prepareValidarArchivo}">
							<p:graphicImage styleClass="ui-icon ui-icon-check"></p:graphicImage>
							<f:attribute name="historialReporte" value="#{row}" />
						</p:commandLink>
					</div>
				</p:column>
			</p:dataTable>
			<p:dialog id="idDialogValidaReporte" width="640"
				header="Validar Archivo: #{historialReporteBackingBean.historialReporte.nombreArchivo}"
				type="cancel" modal="false" widgetVar="dialogValidaReporte">
				<h:panelGrid columns="1">
					<h:column>
						<div align="left" style="width: 600px;">
							<p:fileUpload label="Seleccionar Archivo" id="gDif1"
								required="true"
								requiredMessage="Debe seleccionar el Archivo para validar."
								multiple="false" mode="advanced" auto="true"
								cancelLabel="Cancelar" update="@form"
								invalidFileMessage="El formato del Archivo es invalido, solo se permiten archivos MS Word en formato 2007 o superior"
								invalidSizeMessage="El Archivo a utilizar no puede superar los 3 MB."
								sizeLimit="3145728" allowTypes="/(\.|\/)(docx)$/"
								fileUploadListener="#{historialReporteBackingBean.cargaArchivoListener}">
							</p:fileUpload>
						</div>
					</h:column>

				</h:panelGrid>
			</p:dialog>
		</h:form>
		<script type="text/javascript">  
			function start() {  
			    statusDialog.show();  
			}  
			  
			function stop() {  
			    statusDialog.hide();  
			}  
		</script>
	</ui:define>
</ui:composition>
