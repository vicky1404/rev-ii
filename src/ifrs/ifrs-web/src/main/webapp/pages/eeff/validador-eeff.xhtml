<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/WEB-INF/templates/main-template.xhtml">
	<ui:define name="content">
		<h:form id="form">  
			
			<p:ajaxStatus onstart="statusDialogNoModal.show();" oncomplete="statusDialogNoModal.hide();" />
			<ui:include src="/WEB-INF/templates/ajax-dialog-template.xhtml" />
		<p:panel id="filtro" header="Estados Financieros - Periodo : #{eeff.periodo.periodoFormat}" toggleable="true"  closable="false" toggleSpeed="500" closeSpeed="2000" widgetVar="panel">
		 
		 	<table border="0" width="40%">
		 	<tr>
		 		<td><p:outputLabel for="soc01" value="#{msg.label_tipo_cuadro}"></p:outputLabel></td>
		 		<td>
				<p:selectOneMenu label="#{msg.label_tipo_cuadro}" id="soc01" 
								required="true"                               
                                unselectedLabel="#{msg.general_control_seleccione}"
                                binding="#{eeff.tipoCuadroSelect}" converter="tipoCuadroConverter">
                    <f:selectItem itemLabel="#{msg.label_seleccionar}"/>            
                	<f:selectItems value="#{eeff.componenteBackingBean.tipoCuadroItems}" id="si1"/>
                	<p:ajax listener="#{eeff.tipoCuadroChangeListener}" event="change" />
            	</p:selectOneMenu>
		 		</td>
		 	</tr>
		 	<tr>
		 		<td><p:outputLabel for="it1" value="#{msg.label_cuadro}" /></td>
		 		<td>
					<p:autoComplete value="#{eeff.catalogo}" maxResults="20" maxlength="10" 
									completeMethod="#{eeff.catalogosSugeridos}"
									converter="catalogoConverter"
									effect="drop"	
									var="cat"	
									binding="#{eeff.busquedaInputText}"		
									itemValue="#{cat}"													
									itemLabel="#{cat.nombre}"													 
									id="it1" dropdown="true"/>
		 		</td>
		 	</tr>
		 	<tr>
		 		<td>
			 		<p:commandButton value="Buscar" icon="ui-icon-search" id="cb1"  action="#{eeff.buscarCatalogo}" update="@form"/>
			 		<p:spacer width="10"/>
	            	<p:commandButton value="Limpiar" icon="ui-icon-cancel" id="cb02" actionListener="#{eeff.limpiarCatalogolistener}" update="@form"/>
		 		</td>
		 	</tr>
		 	</table>
		</p:panel>	
		
		<p:spacer height="10"></p:spacer>
		
		<p:treeTable id="tabla" value="#{eeff.root}" var="tree" rendered="#{eeff.renderTreeTabla}" >
    		
    		<p:column headerText="Comentario" resizable="true" selectionMode="single">    		
    			<h:outputText value="#{tree.col1}" style="font-weight:bold;"/>
    			    <p:commandLink actionListener="#{eeff.buscarEstructuraListener}" update="@form" rendered="#{tree.image != null}"
    			    	style="text-decoration: none;"  onmouseover="javascript:this.style.color='SlateGray';" onmouseout="javascript:this.style.color='black';">    			    	
	    				<p:graphicImage value="/resources/images/icon/#{tree.image}" />	 
	    				<p:spacer width="10"/>
	    				<h:outputText value="Cargar contenido"/> 
    			    	<f:attribute name="estructura" value="#{tree.estructura}"/>
	                    <f:attribute name="catalogo" value="#{tree.catalogo}"/>	 
    			    </p:commandLink>    			        				
    		</p:column>
    		<p:column headerText="#{msg.tabla_cabecera_version}" >
    			<h:outputText value="#{tree.col2}" />
    		</p:column>
    		<p:column headerText="#{msg.tabla_cabecera_cuadro}" >
    			<h:outputText value="#{tree.col3}" />
    		</p:column>
    		<p:column headerText="#{msg.tabla_cabecera_estado}" >
    			<h:outputText value="#{tree.col4}" />
    		</p:column>
    		<p:column headerText="#{msg.tabla_cabecera_fecha_proceso}" >
    			<h:outputText value="#{tree.col5}" />   			
    		</p:column>
    		<p:column headerText="#{msg.tabla_cabecera_vigencia}" >
    			<h:outputText value="#{tree.col6 eq 1 ? 'SI' : tree.col6 eq 0 ? 'NO' : '' }" rendered="#{tree.image == null}"/>
    		</p:column>    	
    	</p:treeTable>  
		
		<p:spacer height="10"></p:spacer>
		
		<p:dataTable var="row" value="#{eeff.grillaVO.rows}" rendered="#{eeff.renderEstructuraTabla}">
		
			<p:columns value="#{eeff.grillaVO.columnas}" var="col" columnIndexVar="index" id="columnas">
				 <f:facet name="header">
                 	<h:outputText value="#{col.tituloColumna}" id="ot19"/>
                 </f:facet>
                  <div align="left" style="border: 0px solid;">
					<p:commandLink actionListener="#{eeff.cargarRelacionCeldaListener}" update="@form">
					
						<p:graphicImage value="/resources/images/icon/flecha.jpg" rendered="#{row[col.idColumna].esNumero and row[col.idColumna].sizeRelacionEeffList == 0 and row[col.idColumna].sizeRelacionDetalleEeffList == 0}"/>
						<p:graphicImage value="/resources/images/icon/calculator2.jpg" rendered="#{row[col.idColumna].esNumero and row[col.idColumna].sizeRelacionEeffList != 0 and row[col.idColumna].sizeRelacionDetalleEeffList != 0}"/>
						<f:param name="idColumna" value="#{col.idColumna}" />
                        <f:param name="idGrilla" value="#{col.idGrilla}" />
                        <f:param name="idFila" value="#{row[col.idColumna].idFila}" />
					</p:commandLink>
					
					<h:outputText value="#{row[col.idColumna].valorLong}" id="ot2" style="text-align:right;" rendered="#{row[col.idColumna].tipoDato.idTipoDato == 2}">
						<f:convertNumber integerOnly="true" type="number" maxFractionDigits="0" pattern="##,###,###,###"/>
					</h:outputText>
					
					<h:outputText value="#{row[col.idColumna].valorBigDecimal}" id="ot14" style="text-align:right;" rendered="#{row[col.idColumna].tipoDato.idTipoDato == 3}">
                    	<f:convertNumber integerOnly="false" type="number" maxFractionDigits="4" pattern="##,###,###,###.####"/>
                    </h:outputText>
                    
                    <h:outputText value="#{row[col.idColumna].valor}" id="ot21" style="#{row[col.idColumna].tipoCelda.idTipoCelda == 2 ? 'font-weight:bold; text-align:left;' : ''}" rendered="#{row[col.idColumna].tipoDato.idTipoDato != 3 and row[col.idColumna].tipoDato.idTipoDato != 2}"/>
				</div>
			</p:columns>		
		</p:dataTable> 
		
		<p:spacer height="10" id="s32"/>
		
		
		 <p:dataTable value="#{eeff.estadoFinanciero}" var="row" id="t3" style="height:inherit;">
                <p:column sortable="false" headerText="Id Fecu" align="start" id="c13">
                    
                    <p:commandLink icon="/images/icon/flecha.jpg"  id="cil3" title="#{row.idFecu}" actionListener="#{eeff.cargarFecuListener}" update="@form">
                        <p:graphicImage value="/resources/images/icon/flecha.jpg"></p:graphicImage>
                    	<f:attribute name="eeff" value="#{row}"/>          
                    </p:commandLink>
                   
                    <p:spacer width="5" id="s165"/>
                    <h:outputText value="#{row.idFecu}" id="ot19"/>
                   
                </p:column>
                <p:column sortable="false" headerText="Descripcion" align="start" id="c14">
                    <h:outputText value="#{row.codigoFecu.descripcion}" id="ot15"/>
                </p:column>
                <p:column sortable="false" headerText="Monto Total" align="start" id="c16">
                    <h:outputText value="#{row.montoTotal}" id="ot17" >
                        <f:convertNumber pattern="##,###,###,###" />
                    </h:outputText>
                </p:column>
            </p:dataTable>
		
		<p:spacer height="10" id="s3"/>
		
		
		<p:dataTable value="#{eeff.detalleEeffs}" var="row" id="t4" style="height:inherit" >
		
                <p:column sortable="false" headerText="Fecu" id="c5">
                    
                    <p:commandLink id="cil4"  title="#{row.idCuenta}" actionListener="#{eeff.cargarCuentaListener}" update="@form">
                        <p:graphicImage value="/resources/images/icon/flecha.jpg"></p:graphicImage>
                    	<f:attribute name="detalleEeff" value="#{row}"/>                    
                    </p:commandLink>
                    <p:spacer width="5" id="s15"/>
                    <h:outputText value="#{row.idFecu}" id="ot20"/>
                   
                </p:column>
                <p:column sortable="false" headerText="Número Cuenta" align="start" id="c6">
                    <h:outputText value="#{row.idCuenta}" id="ot4"/>
                </p:column>
                <p:column sortable="false" headerText="Descripcion Cuenta" align="start" id="c7" width="300">
                    <h:outputText value="#{row.descripcionCuenta}" id="ot7"/>
                </p:column>
                <p:column sortable="false" headerText="Monto Miles" align="start" id="c8">
                    <h:outputText value="#{row.montoMiles}" id="ot8"/>
                </p:column>
                <p:column sortable="false" headerText="Monto Ebs" align="start" id="c9">
                    <h:outputText value="#{row.montoEbs}" id="ot9">
                        <f:convertNumber pattern="##,###,###,###" />
                    </h:outputText>
                </p:column>
                <p:column sortable="false" headerText="Monto Pesos" align="start" id="c10">
                    <h:outputText value="#{row.montoPesos}" id="ot10">
                        <f:convertNumber pattern="##,###,###,###" />
                    </h:outputText>
                </p:column>
                <p:column sortable="false" headerText="Mto Reclasificacion" align="start" id="c11" width="250">
                    <h:outputText value="#{row.montoReclasificacion}" id="ot12">
                        <f:convertNumber pattern="##,###,###,###" />
                    </h:outputText>
                </p:column>
            </p:dataTable>
            
        <p:spacer height="10" id="s322"/>
		
		<table align="left">
            <tr>
            <td>
                <p:selectOneMenu label="Código Fecu" id="soc1" value="#{eeff.estadoFinanciero}" converter="estadoFinancieroConverter">
                		<f:selectItem itemLabel="#{msg.label_seleccionar}"></f:selectItem>
                        <f:selectItems value="#{eeff.fecuItems}" id="mesesPeriodo"/>
                        <p:ajax update="@form" listener="#{eeff.codigoFecuChangeListener}" event="change"  />
                </p:selectOneMenu>
            </td>
            <td>
                <p:spacer width="30" id="s9"/>
            </td>
            <td>
                <h:outputLabel value="Celda : " id="ol1"/>
            </td>
            <td>
                <p:inputText  value="#{eeff.relCelda}" readonly="true" size="7" binding="#{eeff.relCeldaText}" id="it2"/>
            </td>
            <td>
                <p:spacer width="25" id="s12"/>
            </td>
            <td>
                <h:outputLabel value="Relación Fecu" id="ol4"/>
            </td>
            <td>
                <!-- p:inputText value="#{eeff.relFecu}" readonly="true"  size="10" binding="#{eeff.relFecuText}" id="it4"/-->
                <p:inputTextarea value="#{eeff.relFecu}"  readonly="true" cols="10" binding="#{eeff.relFecuText}" id="it4"></p:inputTextarea>
            </td>
            <td>
                <p:spacer width="25" id="s11"/>
            </td>
            <td>
                <h:outputLabel value="Relación Cuenta" id="ol2"/>
            </td>
            <td>
                <!-- p:inputText value="#{eeff.relCuenta}" readonly="true" size="10" binding="#{eeff.relCuentaText}" id="it3"/-->
                <p:inputTextarea value="#{eeff.relCuenta}" readonly="true" cols="10" binding="#{eeff.relCuentaText}" id="it3"></p:inputTextarea>
            </td>
            <td>
                <p:spacer width="25" id="s13"/>
            </td>
            <td>
                <p:spacer width="20" id="s10"/>
            </td>
            <td>
                <h:outputLabel value="Guardar" id="ol5"/>
            </td>
            <td>
                <p:commandLink id="cil6" actionListener="#{eeff.guardarRelacionListener}">
                	<p:graphicImage value="/resources/images/icon/save2.png" />
                </p:commandLink>
            </td>
            </tr>
        </table>
		
		</h:form>
	</ui:define>
</ui:composition>
