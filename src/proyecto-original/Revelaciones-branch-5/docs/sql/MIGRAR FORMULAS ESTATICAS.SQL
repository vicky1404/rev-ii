BEGIN

DECLARE

V_FORMULA VARCHAR2(256);

BEGIN

FOR CF IN(SELECT ID_CAMPO_FORMULA, ID_COLUMNA, ID_FILA, ID_GRILLA  FROM REV_CAMPO_FORMULAORDER BY ID_COLUMNA, ID_FILA) LOOP

  V_FORMULA := '';

  FOR FG IN(SELECT ID_CAMPO_FORMULA, ID_COLUMNA, ID_FILA, ID_GRILLA FROM REV_FORMULA_GRILLA WHERE ID_GRILLA = CF.ID_GRILLA AND ID_CAMPO_FORMULA = CF.ID_CAMPO_FORMULA ORDER BY ID_COLUMNA, ID_FILA) LOOP
  
    V_FORMULA := V_FORMULA || '+[' || FG.ID_COLUMNA || ',' || FG.ID_FILA || '];';
  
  END LOOP;
  
    UPDATE REV_CELDA CE  SET FORMULA = V_FORMULA WHERE CE.ID_COLUMNA =  CF.ID_COLUMNA AND CE.ID_FILA = CF.ID_FILA AND CE.ID_GRILLA = CF.ID_GRILLA;
  
    --DBMS_OUTPUT.PUT_LINE(V_FORMULA);
  
END LOOP;

END;

END;