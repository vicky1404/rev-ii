<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	template="/WEB-INF/templates/main-template.xhtml">

	<ui:define name="content">


		

		<h:form id="form">
		
			<p:remoteCommand name="addCelda" actionListener="#{mapeadorTaxonomiaNotasBackingBean.seleccionarCelda}" ></p:remoteCommand>
			<p:remoteCommand name="removeCelda" actionListener="#{mapeadorTaxonomiaNotasBackingBean.deSeleccionarCelda}" ></p:remoteCommand>
			
			
		
			<script type="text/javascript">
				//<![CDATA[
					function seleccionarCelda(obj, celda){
						var o = $(obj);
						if(o.hasClass('ui-state-highlight')){
							o.removeClass('ui-state-highlight');
							removeCelda(celda);
						}else{
							tablaGrilla.jq.find('.ui-state-highlight').removeClass('ui-state-highlight'); 
							o.addClass('ui-state-highlight');
							addCelda(celda)
						}
					}	
				//]]>
			</script>
		
			<p:messages id="messages" autoUpdate="true" globalOnly="true" />
			<p:ajaxStatus onstart="statusDialogNoModal.show();"
				oncomplete="statusDialogNoModal.hide();" />
			<ui:include src="/WEB-INF/templates/ajax-dialog-template.xhtml" />

			<p:panel id="filtro" header="#{menuBackingBean.breadcrumb}"
				toggleable="true" closable="false" toggleSpeed="500"
				closeSpeed="2000" widgetVar="panel">
				<h:panelGrid columns="3" cellpadding="10" border="0">
					<p:selectOneMenu id="sol1" required="true"
						unselectedLabel="#{msg.general_control_seleccione}"
						value="#{navegadorTaxonomiaBackingBean.filtroBackingBean.xbrlTaxonomia}"
						converter="xbrlTaxonomiaConverter">
						<f:selectItems
							value="#{navegadorTaxonomiaBackingBean.xbrlTaxonomiasSelectItem}"
							id="si1" />
					</p:selectOneMenu>



				</h:panelGrid>


				<h:panelGrid columns="3" id="pg3" columnClasses="ancho_100">
					<h:outputLabel value="Tipo y Nombre de Cuadro:" id="ol5" />

					<p:selectOneMenu converter="tipoCuadroConverter"
						value="#{mapeadorTaxonomiaNotasBackingBean.filtroBackingBean.tipoCuadro}">
						<f:selectItem itemLabel="Seleccione" />
						<f:selectItems
							value="#{mapeadorTaxonomiaNotasBackingBean.componenteBackingBean.tipoCuadroItems}" />
						<p:ajax event="change" update="soc1Catalogo"
							listener="#{mapeadorTaxonomiaNotasBackingBean.onChangeTipoCuadro}" />
					</p:selectOneMenu>

					<p:selectOneMenu id="soc1Catalogo" converter="catalogoConverter"
						value="#{mapeadorTaxonomiaNotasBackingBean.filtroBackingBean.catalogo}">
						<f:selectItems
							value="#{mapeadorTaxonomiaNotasBackingBean.catalogoSelectItem}"
							id="catalogo"></f:selectItems>
					</p:selectOneMenu>
				</h:panelGrid>

				<h:panelGrid columns="2">
					<p:commandButton value="Buscar"
						actionListener="#{mapeadorTaxonomiaNotasBackingBean.buscarEstructurasAction}"
						update="@form"></p:commandButton>
					<p:commandButton value="Limpiar" action="mapping-taxonomia-ee-ff"
						immediate="true"></p:commandButton>
				</h:panelGrid>



			</p:panel>

			<p:fieldset
				rendered="#{mapeadorTaxonomiaNotasBackingBean.renderMappingPanel}">

				<p:commandButton
					actionListener="#{mapeadorTaxonomiaNotasBackingBean.guardarMapeo}"
					value="Guardar" />


			</p:fieldset>
			<p:spacer height="10"></p:spacer>


			<p:treeTable value="#{mapeadorTaxonomiaNotasBackingBean.root}"
				rendered="#{mapeadorTaxonomiaNotasBackingBean.renderTreeEstructuras}"
				var="nodo">
				<f:facet name="header">
									Estructuras
								</f:facet>

				<p:column headerText="Titulo">
					<h:outputText value="#{nodo.version.catalogo.titulo}"
						rendered="#{nodo.parent}" />

					<h:commandButton value="Configurar Mapeo XBRL"
						rendered="#{!nodo.parent and nodo.estructura.tipoEstructura.idTipoEstructura == 0}"
						disabled="#{nodo.estructura.tipoEstructura.idTipoEstructura != 0 ? true : false}"
						actionListener="#{mapeadorTaxonomiaNotasBackingBean.buscarTaxonomyAndGrilla}">
						<f:ajax render=":form" />
						<f:attribute name="estructura" value="#{nodo.estructura}" />
					</h:commandButton>

					<p:commandButton value="Tipo Texto falta definir"
						rendered="#{!nodo.parent and nodo.estructura.tipoEstructura.idTipoEstructura != 0}"
						disabled="#{nodo.estructura.tipoEstructura.idTipoEstructura != 0 ? true : false}"
						id="cl2"></p:commandButton>


				</p:column>

				<p:column headerText="Nombre">
					<h:outputText value="#{nodo.estructura.version.catalogo.nombre}"
						rendered="#{!nodo.parent}" />
				</p:column>

				<p:column headerText="Estado">
					<h:outputText value="#{nodo.version.estado.nombre}"
						rendered="#{nodo.parent}" />
				</p:column>

			</p:treeTable>



			<h:panelGrid columns="2" width="100%" id="panelGroup"
				rendered="#{mapeadorTaxonomiaNotasBackingBean.renderMappingPanel}">
				<p:layout fullPage="false" id="ly1" style="min-height:800px">



					<p:layoutUnit position="west" header="Left" resizable="true"
						closable="false" size="800" collapsible="true">


						<p:selectOneMenu label=""
							value="#{mapeadorTaxonomiaNotasBackingBean.parentTaxonomia}">
							<f:selectItems
								value="#{mapeadorTaxonomiaNotasBackingBean.taxonomyParentItems}"
								id="si5" />
							<p:ajax event="change" update="panelGroup"
								listener="#{mapeadorTaxonomiaNotasBackingBean.taxonomyParentChangeListener()}" />
						</p:selectOneMenu>

						<p:treeTable id="arbolConceptos"
							value="#{mapeadorTaxonomiaNotasBackingBean.rootConcept}"
							var="nodo" selectionMode="single"
							selection="#{mapeadorTaxonomiaNotasBackingBean.selectedConcept}">
							
							
							<f:facet name="header">
									Conceptos
								</f:facet>

							<p:column>
								<f:facet name="header">Etiqueta</f:facet>
								<h:outputText value="#{nodo.label}" />
							</p:column>

							<p:column>
								<f:facet name="header">Id</f:facet>
								<h:outputText value="#{nodo.id}" />
							</p:column>

							<p:column>
								<f:facet name="header">Tipo</f:facet>
								<h:outputText value="#{nodo.type}" />
							</p:column>

							<p:column>
								<f:facet name="header">Codigo</f:facet>
								<h:outputText value="#{nodo.codigo}" />
							</p:column>

						</p:treeTable>
					</p:layoutUnit>

					<p:layoutUnit position="north">


						<p:panelGrid columns="2">
							<p:commandButton value="Mapear"
								actionListener="#{mapeadorTaxonomiaNotasBackingBean.mapearConceptosNota}" update="tablaGrillaNotas" />
							<p:commandButton value="Quitar"
								actionListener="#{mapeadorTaxonomiaNotasBackingBean.quitarConceptosEEFF}" />
							
						</p:panelGrid>





					</p:layoutUnit>

					<p:layoutUnit position="center" resizable="true" collapsible="true">



						<p:dataTable
							id="tablaGrillaNotas"
							widgetVar="tablaGrilla"
							value="#{mapeadorTaxonomiaNotasBackingBean.grillaVO.rows}"
							var="row">
							
							<p:columns var="col" columnIndexVar="colStatus"  value="#{mapeadorTaxonomiaNotasBackingBean.grillaVO.columnas}">
							
								<f:facet name="header">
								   
									<div onclick="seleccionarCelda(this, [{name: 'columna', value:  'true'}, {name: 'id1', value:  '#{col.idColumna}'}, {name: 'id2', value:  '#{col.idGrilla}'}])" onmouseover="$(this).addClass('ui-state-hover');" onmouseout="$(this).removeClass('ui-state-hover')">
										<h:outputText value="#{col.tituloColumna} - #{col.idColumna} - #{col.idGrilla}" />
									
								
									<ul>
										<li>ok</li>
									</ul>
									
									</div>		
								</f:facet>
								
									<div onclick="seleccionarCelda(this, [{name: 'columna', value:  'false'}, {name: 'id3', value:  '#{row[col.idColumna].idFila}'}, {name: 'id1', value:  '#{row[col.idColumna].idColumna}'}, {name: 'id2', value:  '#{row[col.idColumna].idGrilla}'}])" onmouseover="$(this).addClass('ui-state-hover')" onmouseout="$(this).removeClass('ui-state-hover')">

									<!--
									headerText="#{col.tituloColumna}"
									
									 h:outputText value="[#{row[col.idColumna].idFila} - #{row[col.idColumna].idColumna}]"
                                                                       inlineStyle="padding-bottom:10px;font-weight:bold"  / -->

									<h:outputText value="#{row[col.idColumna].valor}"
										inlineStyle="#{row[col.idColumna].tipoCelda.idTipoCelda == 4 or row[col.idColumna].tipoCelda.idTipoCelda == 5 ? 'padding-left:10px;font-weight:bold' : 'padding-left:10px'}"
										rendered="#{ (row[col.idColumna].tipoCelda.idTipoCelda == 0 or row[col.idColumna].tipoCelda.idTipoCelda == 4 or row[col.idColumna].tipoCelda.idTipoCelda == 5) and (row[col.idColumna].tipoDato.idTipoDato != 2 and row[col.idColumna].tipoDato.idTipoDato != 3) }" />

									<h:outputText value="#{row[col.idColumna].valor}" id="ot8"
										inlineStyle="font-weight:bold; text-align:left;"
										rendered="#{row[col.idColumna].tipoCelda.idTipoCelda == 2}" />

									<h:outputText value="#{row[col.idColumna].valor}"
										rendered="#{row[col.idColumna].tipoCelda.idTipoCelda == 6 and row[col.idColumna].tipoDato.idTipoDato == 0}" />

									<h:outputText value="#{row[col.idColumna].valorLong}"
										rendered="#{row[col.idColumna].tipoDato.idTipoDato == 2}" />



									<h:outputText value="#{row[col.idColumna].valorBigDecimal}"
										rendered="#{row[col.idColumna].tipoDato.idTipoDato == 3}" />

									<h:outputText value="#{row[col.idColumna].valorDate}"
										rendered="#{row[col.idColumna].tipoDato.idTipoDato == 1 and row[col.idColumna].tipoCelda.idTipoCelda == 6}" />

									<p:dataList value="#{mapeadorTaxonomiaNotasBackingBean.mapping[row[col.idColumna]]}" var="concept">
										#{concept.id}
									</p:dataList>
									
									</div>



							</p:columns>
						</p:dataTable>


					</p:layoutUnit>
				</p:layout>
			</h:panelGrid>
		</h:form>
	</ui:define>
</ui:composition>
